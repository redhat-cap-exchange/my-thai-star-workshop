FROM ansibleplaybookbundle/apb-base:release-1.3

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiByb2FkLXRvLWNsb3VkLW5hdGl2ZS13b3Jrc2hvcC1hcGIK\
ZGVzY3JpcHRpb246IEFQQiB0byBkZXBsb3kgcmVxdWlyZWQgaW5mcmEgY29tcG9uZW50cyBmb3Ig\
Um9hZC10by1DbG91ZC1OYXRpdmUgV29ya3Nob3BzIG9uIGFuIE9wZW5TaGlmdCBjbHVzdGVyCmJp\
bmRhYmxlOiBGYWxzZQphc3luYzogb3B0aW9uYWwKdGFnczoKLSB3b3Jrc2hvcAotIGNsb3VkLW5h\
dGl2ZQptZXRhZGF0YToKICBkZXBlbmRlbmNpZXM6IFtdCiAgZGlzcGxheU5hbWU6ICJSb2FkLXRv\
LUNsb3VkLU5hdGl2ZSBXb3Jrc2hvcCAoQ29kZVJlYWR5KSBJbnN0YWxsZXIiCiAgbG9uZ0Rlc2Ny\
aXB0aW9uOiAiUmVxdWlyZWQgY29tcG9uZW50cyAoQ29kZVJlYWR5IFdvcmtzcGFjZXMsIE5leHVz\
LCBHdWlkZXMgZXRjKSIKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29uQ2xhc3M6ICJwZmljb24g\
cGZpY29uLXNlcnZpY2VzIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgpw\
bGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBUaGlzIGRlZmF1bHQgcGxh\
biBkZXBsb3lzIHJvYWQtdG8tY2xvdWQtbmF0aXZlLXdvcmtzaG9wCiAgICBmcmVlOiBUcnVlCiAg\
ICBtZXRhZGF0YToge30KICAgIHBhcmFtZXRlcnM6CiAgICAtIG5hbWU6IG9wZW5zaGlmdF91c2Vy\
CiAgICAgIHRpdGxlOiBVc2VybmFtZQogICAgICBkZXNjcmlwdGlvbjogVXNlciBpcyByZXF1aXJl\
ZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBhZG1pbiByZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBNYXN0\
ZXIKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBQYXNzd29yZAog\
ICAgICBkZXNjcmlwdGlvbjogUGFzc3dvcmQgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIHByb2pl\
Y3QgYWRtaW4gcmVzb3VyY2VzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1\
ZQogICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5T\
aGlmdCBNYXN0ZXIKICAgIC0gbmFtZTogdXNlcl9jb3VudAogICAgICB0aXRsZTogTnVtYmVyIG9m\
IFBhcnRpY2lwYW50cwogICAgICBkZXNjcmlwdGlvbjogVGhlIG51bWJlciBvZiBwYXJ0aWNpcGFu\
dHMKICAgICAgdHlwZTogbnVtYmVyCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRlZmF1bHQ6\
IDEwCiAgICAgIGRpc3BsYXlfdHlwZTogbnVtYmVyCiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYnMg\
JiBHdWlkZXMKICAgIC0gbmFtZTogb3BlbnNoaWZ0X21hc3Rlcl91cmwKICAgICAgdGl0bGU6IE9w\
ZW5TaGlmdCBNYXN0ZXIgVVJMCiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgYWRkcmVzcyB0byBPcGVu\
U2hpZnQgbWFzdGVyIFVSTCB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGxhYiBndWlkZSB0byBwYXJ0\
aWNpcGFudHMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRp\
c3BsYXlfdHlwZTogc3RyaW5nCiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYnMgJiBHdWlkZXMKICAg\
IC0gbmFtZTogaW5mcmFzdmNzX2FkbV91c2VyCiAgICAgIHRpdGxlOiBJbmZyYSBTZXJ2aWNlcyBB\
ZG1pbiBVc2VyCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiB1c2VyIGZvciBpbmZyYXN0cnVjdHVy\
ZSBzZXJ2aWNlcyAoR29ncywgTmV4dXMsIC4uLikKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRl\
ZmF1bHQ6ICJhZG1pbnVzZXIiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlw\
ZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBXb3Jrc2hvcCBJbmZyYSBTZXJ2aWNlcwogICAg\
LSBuYW1lOiBpbmZyYXN2Y3NfYWRtX3B3ZAogICAgICB0aXRsZTogSW5mcmEgU2VydmljZXMgQWRt\
aW4gUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246IEFkbWluIHBhc3N3b3JkIGZvciBpbmZyYXN0\
cnVjdHVyZSBzZXJ2aWNlcyAoR29ncywgTmV4dXMsIC4uLikKICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgIGRlZmF1bHQ6ICJhZG1pbnB3ZCIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxh\
eV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wIEluZnJhIFNlcnZpY2Vz\
CiAgICAgIA=="


COPY playbooks /opt/apb/project
ADD requirements.yml /opt/apb/project/requirements.yml
RUN ansible-galaxy install -r /opt/apb/project/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
